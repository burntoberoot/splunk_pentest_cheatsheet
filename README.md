# Splunk pentest cheatsheet

## Internal structure

Splunk has it's own structure that is simmilar to linux, i.e

root - `$SPLUNK_HOME` - (default is `/opt/splunk`)

- `bin/`
	- `scripts/`
		- scripts that will be executed after specific allert is triggered
- `etc/`
	- `passwd` -  file with logins and hashes of splunk users 
	- `apps/` - directory conains all installed app
		- `<some_app>/`
			- `appserver/`
				- `static/`
				- `controllers/`
					- `<some_script_0.py>`
			- `default/`
				- `data/` 
				- `app.conf` - genereal info about app - name, description, checksum
				- `web.conf` - file that contains list of `endpoints`. Every endpoint is a script in `../appserver/controllers` without extension, i.e. `<some_script_0>` 
			- `local/`
				- `/local`
					- `savedsearches.conf` - list of alerts assosiacted with a current app. Every alert described as what action will be made for corresponding condition
			- `metadata/`
				- default.meta -
				- local.meta - alerts' creation time and their owners
			- `static/`
	- `users/`
- `share/`
- `var/`
- `openssl/`

## SPL - Search Processing Language

### Usefull SPL requests

- `| metasearch index=* | chart count over source by index` - get all indexes
- `| chart count by source | sort count desc` - get indexes and sources
- `| search index=<index name>` - get content of an index
- `| inputcsv 123.csv` - get the value of $SPLUNK_HOME

## Ways to enumerate users

### Authenticated

- `https://<host>/en-US/splunkd/__raw/servicesNS/<username>/user-prefs/data/user-prefs/general`

## Misc

### Check your capabilities and other info

- `https://<host>/en-US/splunkd/__raw/services/authentication/users/<yourusername>`

### Usefull Links

- SPL
	- [SPL quick reference guide - pdf](https://www.splunk.com/pdfs/solution-guides/splunk-quick-reference-guide.pdf)
- Pentest
	- [Penetration Testing with Splunk: Leveraging Splunk Admin Credentials to Own the Enterprise by Kevin Dick](https://threat.tevora.com/penetration-testing-with-splunk-leveraging-splunk-admin-credentials-to-own-the-enterprise/)
	- [How to secure and harden your Splunk software installation](https://docs.splunk.com/Documentation/Splunk/7.2.3/Security/Hardeningstandards)
